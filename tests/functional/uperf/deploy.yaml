apiVersion: v1
kind: Pod
metadata:
  name: uperf-test-pod
  labels:
    test: snafu
spec:
  containers:
  - name: es01
    image: docker.elastic.co/elasticsearch/elasticsearch:7.13.3
    ports:
    - containerPort: 9200
    env:
    - name: discovery.type
      value: single-node
    - name:
  - name: uperf_server
    image: ${UPERF_IMAGE}
    container_name: uperfserver
    command: ["uperf", "-s"]
  - name: uperf
    image: ${UPERF_IMAGE}
    container_name: uperf
    command: ["tail", "-f", "/dev/null"]
    env:
      - name: es
        value: http://localhost:9200
      - name: es_verify_cert
        value: false
    volumeMounts:
    - mountPath: /root/configs
      name: config-mount
      readOnly: true
    securityContext:
      seLinuxOptions:
        type: spc_t
  volumes:
  - name: config-mount
    hostPath:
      path: tests/functional/uperf/configs
      type: Directory
